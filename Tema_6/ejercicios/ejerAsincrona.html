<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    ul{
        border: 2px solid black;
        font-size: 22px;
        font-family: Arial, "Helvetica Neue", Helvetica, sans-serif; 
        width: 400px;  
    }
    .españa{
        border: 2px solid red;
    }
</style>

<body>

    <script>
        let indice = 0;
        let vectorEspaña = [];
        let vectorHolanda = [];
        let vectorAustria = [];
        let vectorItalia = [];

        function bolsa() {
            let paises = ["España", "Holanda", "Austria", "Italia"];
            var tiempo = Math.floor(Math.random() * (8 - 1) + 1);

            globalThis.resultados = paises.map((pais) => ({
                nombre: pais,
                valor: Math.random() * (1 - 0) + 0,
            }));

            return new Promise(function (resolve, reject) {
                setTimeout(() => {
                    //console.log(resultados);
                    return resultados;

                    resolve();
                }, (tiempo * 1000));
            });
        }

        function metereologico() {
            var tiempo = Math.floor(Math.random() * (4 - 1) + 1);
            var numeroVector = Math.floor(Math.random() * (4 - 0) + 0);
            let array = ["soleado", "nublado", "lluvioso", "granizando", "tornado"];

            return new Promise(function (resolve, reject) {
                setTimeout(() => {
                    globalThis.clima = array[numeroVector];
                    resolve();
                }, (tiempo * 1000));
            });
        }

        function unificarHtml() {

            var newUl = document.createElement('ul');
            var newItem1 = document.createElement('li');
            newItem1.textContent = resultados[0].nombre + " vale " + resultados[0].valor;
            newItem1.setAttribute("onclick", "mostrarArray()");
            
            var copia1 = newItem1.textContent;
            console.log(copia1);
            if (vectorEspaña.length == 15) {
                vectorEspaña.shift();
                vectorEspaña.push(copia1);
            }else{
                vectorEspaña.push(copia1);
            }

            
            var newItem2 = document.createElement('li');
            newItem2.textContent = resultados[1].nombre + " vale " + resultados[1].valor;
            var newItem3 = document.createElement('li');
            newItem3.textContent = resultados[2].nombre + " vale " + resultados[2].valor;
            var newItem4 = document.createElement('li');
            newItem4.textContent = resultados[3].nombre + " vale " + resultados[3].valor;
            var newItem5 = document.createElement('li');
            newItem5.textContent = "El clima es " + clima;

            newUl.appendChild(newItem1);//Le añado id
            newUl.appendChild(newItem2);
            newUl.appendChild(newItem3);
            newUl.appendChild(newItem4);
            newUl.appendChild(newItem5);

            var body = document.body;
            body.appendChild(newUl);

            
        }

        function mostrarArray() {
            //array.shift(); borra el primer elemento
            //pila.push('a'); añade un elemento al final
            //pila.size(); te dice la longitud del vector
            //console.log("España de mostrar Array");
            vectorEspaña.forEach(element => {
                var newUl = document.createElement('ul');
                newUl.textContent=element;
                //newUl.appendChild(element);
                newUl.setAttribute("class", "españa");

                var body = document.body;
                body.appendChild(newUl);
            });

        }

        /*
        async function resultado(){

            let resultado1 = await metereologico();
            let resultado2 = await bolsa(resultado1);
            unificarHtml();
        }
    */
        function repetir() {
            let hoyPromesa = metereologico();
            hoyPromesa
                .then(bolsa())
                .then(unificarHtml());
        }
        

        setInterval(() => {
            repetir();
        }, 2000);
        
        
        

        



    </script>

</body>

</html>